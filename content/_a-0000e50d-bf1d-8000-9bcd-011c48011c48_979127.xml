<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<contentHaul xmlns:a="http://www.appian.com/ae/types/2009">
    <versionUuid>_a-0000e70f-2824-8000-9c01-011c48011c48_2702604</versionUuid>
    <interface>
        <name>AS_FS_FM_customerDetails</name>
        <uuid>_a-0000e50d-bf1d-8000-9bcd-011c48011c48_979127</uuid>
        <description>Displays the basic information of the customer</description>
        <parentUuid>_a-0000e4b1-2fbc-8000-9bc6-011c48011c48_968428</parentUuid>
        <visibility>
            <advertise>false</advertise>
            <hierarchy>true</hierarchy>
            <indexable>true</indexable>
            <quota>false</quota>
            <searchable>true</searchable>
            <system>false</system>
            <unlogged>false</unlogged>
        </visibility>
        <definition>a!localVariables(
  local!i18nData: #"_a-0000e50d-bf1d-8000-9bcd-011c48011c48_975720"(triggerRefresh: null),
  local!isCHSIntegrationInvoked: false(),
  local!refData: #"_a-0000e50d-bf1d-8000-9bcd-011c48011c48_975294"(
    typeList: {
      #"_a-0000e50d-bf1d-8000-9bcd-011c48011c48_978922",
      #"_a-0000e50d-bf1d-8000-9bcd-011c48011c48_979836",
      #"_a-0000e50d-bf1d-8000-9bcd-011c48011c48_979842",
      #"_a-0000e50d-bf1d-8000-9bcd-011c48011c48_979755",
      #"_a-0000e50d-bf1d-8000-9bcd-011c48011c48_983312",
      #"_a-0000e50d-bf1d-8000-9bcd-011c48011c48_988422",
      #"_a-0000e50d-bf1d-8000-9bcd-011c48011c48_979240"
    },
    i18nData: local!i18nData
  ),
  local!chsToggle: #"_a-0000e2ad-62e7-8000-9ba2-011c48011c48_75800"(
    cdt: ri!userSettings,
    field: "userSettingCode",
    value: #"_a-0000e5fd-0ed3-8000-9be6-011c48011c48_1579647"
  ).userSettingValue[1],
  local!isCreate: a!refreshVariable(
    value: #"_a-0000e2ad-62e7-8000-9ba2-011c48011c48_73536"(ri!customer.name),
    refreshOnReferencedVarChange: false
  ),
  local!triggerRefresh: a!refreshVariable(
    value: now(),
    refreshAfter: "RECORD_ACTION"
  ),
  local!chsCompanyDetails: #"_a-0000e5a0-53e9-8000-9bd8-011c48011c48_1413279"(
    customerId: ri!customer.customerId,
    returnType: #"_a-0000e415-3035-8000-9bb2-011c48011c48_290157"
  ),
  local!refreshedChsCompanyDetails: #"_a-0000e5a0-53e9-8000-9bd8-011c48011c48_1413279"(
    customerId: ri!customer.customerId,
    returnType: #"_a-0000e415-3035-8000-9bb2-011c48011c48_290157",
    triggerRefresh: local!triggerRefresh
  ),
  local!addresses: #"_a-0000e4b1-2fbc-8000-9bc6-011c48011c48_968447"(
    customerId: ri!customer.customerId,
    isActive: true,
    sort: #"SYSTEM_SYSRULES_sortInfo"(field: "addressType", ascending: false),
    triggerRefresh: local!triggerRefresh
  ),
  local!countries: #"_a-0000e50d-bf1d-8000-9bcd-011c48011c48_976936"(
    i18nData: local!i18nData,
    returnType: #"_a-0000e415-3035-8000-9bb2-011c48011c48_290163"
  ),
  local!states: #"_a-0000e50d-bf1d-8000-9bcd-011c48011c48_978878"(
    i18nData: local!i18nData,
    returnType: #"_a-0000e415-3035-8000-9bb2-011c48011c48_290163"
  ),
  local!customerOpenServiceRequests: #"_a-0000e62c-7375-8000-9bec-011c48011c48_1775427"(
    customerId: ri!customer.customerId,
    isActive: true,
    excludeNestedCdts: true,
    /* Sort so that the SRQs that are expected to be completed last are first in the list,
    then we can easily index to the first position for the correct pending value in below rules */
    sort: #"SYSTEM_SYSRULES_sortInfo"(
      field: "targetCompletionDate",
      ascending: false
    )
  ),
  if(
    ri!readOnly,
    #"SYSTEM_SYSRULES_headerContentLayout"(
      contents: {
        #"_a-0000e586-af6f-8000-9bd2-011c48011c48_1351298"(
          customer: ri!customer,
          i18nData: local!i18nData,
          refData: local!refData,
          chsCompanyDetails: local!refreshedChsCompanyDetails,
          countries: local!countries,
          customerOpenServiceRequests: local!customerOpenServiceRequests
        )
      },
      backgroundColor: "TRANSPARENT"
    ),
    #"SYSTEM_SYSRULES_formLayout_v1"(
      label: #"_a-0000e2cd-bc96-8000-9ba2-011c48011c48_81818"(
        i18nData: local!i18nData,
        bundleKey: if(
          local!isCreate,
          "AS.FS.AllBundles.lbl_CreateCustomer",
          "AS.FS.AllBundles.lbl_UpdateCustomerDetails"
        )
      ),
      contents: {
        #"SYSTEM_SYSRULES_columnsLayout"(
          columns: {
            #"SYSTEM_SYSRULES_columnLayout"(width: "WIDE_PLUS"),
            #"SYSTEM_SYSRULES_columnLayout"(
              #"SYSTEM_SYSRULES_ButtonArrayLayout"(
                buttons: {
                  #"SYSTEM_SYSRULES_ButtonWidget"(
                    label: #"_a-0000e2cd-bc96-8000-9ba2-011c48011c48_81818"(
                      i18nData: local!i18nData,
                      bundleKey: "AS.FS.AllBundles.btn_RetriveCustomerDetails"
                    ),
                    icon: "cloud-download",
                    tooltip: if(
                      local!chsToggle,
                      if(
                        len(ri!customer.customerNumber) &lt;&gt; #"_a-0000e5a0-53e9-8000-9bd8-011c48011c48_1407440",
                        #"_a-0000e2cd-bc96-8000-9ba2-011c48011c48_81818"(
                          i18nData: local!i18nData,
                          bundleKey: "AS.FS.AllBundles.ins_ProvideValidCustomerNumber"
                        ),
                        #"_a-0000e2cd-bc96-8000-9ba2-011c48011c48_81818"(
                          i18nData: local!i18nData,
                          bundleKey: "AS.FS.AllBundles.ins_PopulateAdditionalCustomerDetails"
                        )
                      ),
                      #"_a-0000e2cd-bc96-8000-9ba2-011c48011c48_81818"(
                        i18nData: local!i18nData,
                        bundleKey: "AS.FS.AllBundles.ins_CompaniesHouseIntegrationIsTurnedOff"
                      )
                    ),
                    saveInto: {
                      #"SYSTEM_SYSRULES_startProcess"(
                        processModel: #"_a-0000e5a0-53e9-8000-9bd8-011c48011c48_1407181",
                        processParameters: {
                          customer: ri!customer,
                          existingCompanyDetails: local!chsCompanyDetails
                        },
                        onSuccess: {
                          a!save(
                            local!isCHSIntegrationInvoked,
                            not(local!isCHSIntegrationInvoked)
                          ),
                          a!save(
                            local!chsCompanyDetails,
                            fv!processInfo.pv.existingCompanyDetails
                          ),
                          a!save(
                            local!addresses,
                            #"_a-0000e2ad-62e7-8000-9ba2-011c48011c48_73980"(
                              nullableValue: append(
                                local!addresses,
                                local!chsCompanyDetails.address
                              ),
                              replacementValue: {}
                            )
                          )
                        }
                      )
                    },
                    style: "SECONDARY",
                    disabled: or(
                      len(ri!customer.customerNumber) &lt;&gt; #"_a-0000e5a0-53e9-8000-9bd8-011c48011c48_1407440",
                      not(local!chsToggle)
                    )
                  )
                }
              )
            )
          },
          showWhen: local!isCreate,
          marginBelow: "NONE"
        ),
        #"d9cf1571-4531-418c-b5ba-8aa6330febeb"(
          customer: ri!customer,
          i18nData: local!i18nData,
          refData: local!refData,
          readOnly: ri!readOnly,
          showHeader: local!isCreate,
          customerOpenServiceRequests: local!customerOpenServiceRequests,
          countries: local!countries
        ),
        #"_a-0000e5fd-0ed3-8000-9be6-011c48011c48_1573084"(
          customer: ri!customer,
          i18nData: local!i18nData,
          readOnly: ri!readOnly,
          chsCompanyDetails: local!chsCompanyDetails,
          showCompanyHouseLink: false
        ),
        if(
          local!isCreate,
          {
            #"SYSTEM_SYSRULES_richTextDisplayField"(
              labelPosition: "COLLAPSED",
              value: char(10)
            ),
            #"_a-0000e5a0-53e9-8000-9bd8-011c48011c48_1430833"(
              customer: ri!customer,
              i18nData: local!i18nData
            ),
            #"SYSTEM_SYSRULES_richTextDisplayField"(
              labelPosition: "COLLAPSED",
              value: char(10)
            ),
            #"_a-0000e5a0-53e9-8000-9bd8-011c48011c48_1441360"(
              i18nData: local!i18nData,
              customer: ri!customer,
              isCHSIntegrationInvoked: local!isCHSIntegrationInvoked
            ),
            #"SYSTEM_SYSRULES_richTextDisplayField"(
              labelPosition: "COLLAPSED",
              value: char(10)
            ),
            #"5cb92c35-d166-4315-8e45-a9907aa21d7b"(
              customer: ri!customer,
              i18nData: local!i18nData
            ),
            #"SYSTEM_SYSRULES_richTextDisplayField"(
              labelPosition: "COLLAPSED",
              value: char(10)
            ),
            #"_a-0000e50d-bf1d-8000-9bcd-011c48011c48_985815"(
              customer: ri!customer,
              i18nData: local!i18nData,
              refData: local!refData
            ),
            #"SYSTEM_SYSRULES_richTextDisplayField"(
              labelPosition: "COLLAPSED",
              value: char(10)
            ),
            #"_a-0000e50d-bf1d-8000-9bcd-011c48011c48_981640"(
              customerId: ri!customer.customerId,
              i18nData: local!i18nData,
              refData: local!refData,
              addresses: local!addresses,
              countries: local!countries,
              states: local!states
            ),
            #"SYSTEM_SYSRULES_richTextDisplayField"(
              labelPosition: "COLLAPSED",
              value: char(10)
            ),
            #"_a-0000e50d-bf1d-8000-9bcd-011c48011c48_979815"(
              customerId: ri!customer.customerId,
              i18nData: local!i18nData,
              refData: local!refData,
              contacts: ri!contacts,
              countries: local!countries,
              states: local!states
            )
          },
          {
            /* Updating the above items is handled directly in the customerDetails basic info view */
            /* to avoid confusion about saving behavior of nested record actions */
            
          }
        )
      },
      buttons: #"_a-0000e3d1-f4dc-8000-9ba4-011c48011c48_134344"(
        confirmLabel: #"_a-0000e2cd-bc96-8000-9ba2-011c48011c48_81818"(
          i18nData: local!i18nData,
          bundleKey: if(
            local!isCreate,
            "AS.FS.AllBundles.btn_CreateCustomer",
            "AS.FS.AllBundles.lbl_UpdateCustomerDetails"
          )
        ),
        cancelLabel: #"_a-0000e2cd-bc96-8000-9ba2-011c48011c48_81818"(
          i18nData: local!i18nData,
          bundleKey: "AS.FS.AllBundles.btn_Cancel"
        ),
        confirmSaveInto: {
          a!save(
            ri!userAction,
            #"_a-0000e2ad-62e7-8000-9ba2-011c48011c48_73305"
          ),
          if(
            ri!customer.domicile.countryCode &lt;&gt; #"_a-0000e50d-bf1d-8000-9bcd-011c48011c48_981494",
            a!save(
              { ri!customer.isERISA, ri!customer.taxId },
              null
            ),
            {}
          ),
          if(
            local!isCreate,
            #"_a-0000e539-6d59-8000-9bd0-011c48011c48_1234294"(),
            {}
          ),
          a!save(
            ri!chsCompanyDetails,
            local!chsCompanyDetails
          ),
          a!save(
            ri!chsCompanyDetails.previousCompanyDetails,
            #"_a-0000e5a0-53e9-8000-9bd8-011c48011c48_1430726"(
              customerId: ri!customer.customerId,
              returnType: #"_a-0000e415-3035-8000-9bb2-011c48011c48_290163"
            )
          ),
          a!save(
            ri!contacts.customerId,
            ri!customer.customerId
          )
        },
        cancelSaveInto: {
          a!save(
            ri!userAction,
            #"_a-0000e2ad-62e7-8000-9ba2-011c48011c48_73173"
          ),
          if(
            local!isCreate,
            {
              #"_a-0000e539-6d59-8000-9bd0-011c48011c48_1234308"()
            },
            {}
          )
        },
        confirmSubmit: true,
        cancelSubmit: true,
        showWhen: not(ri!readOnly)
      )
    )
  )
)</definition>
        <namedTypedValue>
            <name>customer</name>
            <type>
                <name>AS_FS_Customer</name>
                <namespace>urn:com:appian:types:AS:FS</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>readOnly</name>
            <type>
                <name>boolean</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>userAction</name>
            <type>
                <name>string</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
            <value/>
        </namedTypedValue>
        <namedTypedValue>
            <name>chsCompanyDetails</name>
            <type>
                <name>AS_FS_CHS_CompanyDetails</name>
                <namespace>urn:com:appian:types:AS:FS</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>userSettings</name>
            <type>
                <name>AS_FS_AllUserSettings?list</name>
                <namespace>urn:com:appian:types:AS:FS</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>contacts</name>
            <type>
                <name>AS_FS_Contact?list</name>
                <namespace>urn:com:appian:types:AS:FS</namespace>
            </type>
        </namedTypedValue>
        <preferredEditor>interface</preferredEditor>
        <offlineEnabled>false</offlineEnabled>
        <isCustom>false</isCustom>
    </interface>
    <roleMap public="true">
        <role inherit="true" allowForAll="false" name="readers">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="authors">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="administrators">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyReaders">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAuthors">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAdministrators">
            <users/>
            <groups/>
        </role>
    </roleMap>
    <typedValue>
        <type>
            <name>RuleTestConfig?list</name>
            <namespace>http://www.appian.com/ae/types/2009</namespace>
        </type>
        <value>
            <el>
                <a:name/>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="a:Expression">#"_a-0000e2cd-bc96-8000-9ba2-011c48011c48_33079"(
  customerId: 47,
  returnType: #"_a-0000e415-3035-8000-9bb2-011c48011c48_290157"
)</a:value>
                    <a:nameRef>customer</a:nameRef>
                    <a:id>1</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="xsd:boolean">false</a:value>
                    <a:nameRef>readOnly</a:nameRef>
                    <a:id>2</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="xsd:string"/>
                    <a:nameRef>userAction</a:nameRef>
                    <a:id>3</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:n1="urn:com:appian:types:AS:FS" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true" xsi:type="n1:AS_FS_CHS_CompanyDetails"/>
                    <a:nameRef>chsCompanyDetails</a:nameRef>
                    <a:id>4</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="a:Expression">#"_a-0000e5d6-d648-8000-9bde-011c48011c48_1501904"(
  settingsCode:{
    #"_a-0000e5fd-0ed3-8000-9be6-011c48011c48_1579647",
    #"_a-0000e5fd-0ed3-8000-9be6-011c48011c48_1579749",

    #"_a-0000e5fd-0ed3-8000-9be6-011c48011c48_1579609"
    }
)</a:value>
                    <a:nameRef>userSettings</a:nameRef>
                    <a:id>5</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>
                    <a:nameRef>contacts</a:nameRef>
                    <a:id>6</a:id>
                </a:ruleInputTestConfigs>
                <a:assertions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>
            </el>
        </value>
    </typedValue>
    <history>
        <historyInfo versionUuid="_a-0000e50d-bf1d-8000-9bcd-011c48011c48_1003784"/>
        <historyInfo versionUuid="_a-0000e528-bc07-8000-9bcf-011c48011c48_1039761"/>
        <historyInfo versionUuid="_a-0000e539-6d59-8000-9bd0-011c48011c48_1236189"/>
        <historyInfo versionUuid="_a-0000e539-6d59-8000-9bd0-011c48011c48_1248065"/>
        <historyInfo versionUuid="_a-0000e586-af6f-8000-9bd2-011c48011c48_1329645"/>
        <historyInfo versionUuid="_a-0000e586-af6f-8000-9bd2-011c48011c48_1352153"/>
        <historyInfo versionUuid="_a-0000e586-af6f-8000-9bd2-011c48011c48_1376762"/>
        <historyInfo versionUuid="_a-0000e59f-bdcf-8000-9bd4-011c48011c48_1393575"/>
        <historyInfo versionUuid="_a-0000e5a0-53e9-8000-9bd8-011c48011c48_1435809"/>
        <historyInfo versionUuid="_a-0000e5a0-53e9-8000-9bd8-011c48011c48_1451903"/>
        <historyInfo versionUuid="_a-0000e5a0-53e9-8000-9bd8-011c48011c48_1460302"/>
        <historyInfo versionUuid="_a-0000e5fd-0ed3-8000-9be6-011c48011c48_1567442"/>
        <historyInfo versionUuid="_a-0000e5fd-0ed3-8000-9be6-011c48011c48_1579600"/>
        <historyInfo versionUuid="_a-0000e5fd-0ed3-8000-9be6-011c48011c48_1586428"/>
        <historyInfo versionUuid="_a-0000e5fd-0ed3-8000-9be6-011c48011c48_1588090"/>
        <historyInfo versionUuid="_a-0000e607-97fd-8000-9be9-011c48011c48_1604388"/>
        <historyInfo versionUuid="_a-0000e607-97fd-8000-9be9-011c48011c48_1609042"/>
        <historyInfo versionUuid="_a-0000e607-97fd-8000-9be9-011c48011c48_1609438"/>
        <historyInfo versionUuid="_a-0000e607-97fd-8000-9be9-011c48011c48_1619824"/>
        <historyInfo versionUuid="_a-0000e607-97fd-8000-9be9-011c48011c48_1634290"/>
        <historyInfo versionUuid="_a-0000e607-97fd-8000-9be9-011c48011c48_1705951"/>
        <historyInfo versionUuid="_a-0000e62c-7375-8000-9bec-011c48011c48_1791449"/>
        <historyInfo versionUuid="_a-0000e62c-7375-8000-9bec-011c48011c48_1818176"/>
        <historyInfo versionUuid="_a-0000e62c-7375-8000-9bec-011c48011c48_1819917"/>
        <historyInfo versionUuid="_a-0000e62c-7375-8000-9bec-011c48011c48_1820558"/>
        <historyInfo versionUuid="_a-0000e62c-7375-8000-9bec-011c48011c48_1824246"/>
        <historyInfo versionUuid="_a-0000e62c-7375-8000-9bec-011c48011c48_1924202"/>
        <historyInfo versionUuid="_a-0000e62c-7375-8000-9bec-011c48011c48_1937441"/>
        <historyInfo versionUuid="_a-0000e673-a4a7-8000-9bef-011c48011c48_2047754"/>
        <historyInfo versionUuid="_a-0000e69f-3688-8000-9bf2-011c48011c48_2116883"/>
        <historyInfo versionUuid="_a-0000e69f-3688-8000-9bf2-011c48011c48_2151702"/>
        <historyInfo versionUuid="_a-0000e69f-3688-8000-9bf2-011c48011c48_2157405"/>
        <historyInfo versionUuid="_a-0000e6c5-6536-8000-9bf8-011c48011c48_2206322"/>
        <historyInfo versionUuid="_a-0000e70f-2824-8000-9c01-011c48011c48_2514256"/>
        <historyInfo versionUuid="_a-0000e70f-2824-8000-9c01-011c48011c48_2702604"/>
    </history>
</contentHaul>
