<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<contentHaul xmlns:a="http://www.appian.com/ae/types/2009">
    <versionUuid>_a-0000e81d-5ddb-8000-9c1b-011c48011c48_3539990</versionUuid>
    <rule>
        <name>AS_FS_UT_constructParameters_forUpdateRefData</name>
        <uuid>_a-0000e539-6d59-8000-9bd0-011c48011c48_1177201</uuid>
        <description>Builds ref data update process parameters for generic ref data updates (bundle info, refData itself, etc).</description>
        <parentUuid>_a-0000e4b1-2fbc-8000-9bc6-011c48011c48_968428</parentUuid>
        <visibility>
            <advertise>false</advertise>
            <hierarchy>true</hierarchy>
            <indexable>true</indexable>
            <quota>false</quota>
            <searchable>true</searchable>
            <system>false</system>
            <unlogged>false</unlogged>
        </visibility>
        <definition>if(
  or(
    #"_a-0000e2ad-62e7-8000-9ba2-011c48011c48_73536"(ri!refData),
    #"_a-0000e2ad-62e7-8000-9ba2-011c48011c48_73536"(ri!bundleName),
    #"_a-0000e2ad-62e7-8000-9ba2-011c48011c48_73536"(ri!newValue),
    #"_a-0000e2ad-62e7-8000-9ba2-011c48011c48_73536"(ri!bundleFolder)
  ),
  {},
  a!localVariables(
    local!triggerRefresh: a!refreshVariable(value: now(), refreshAlways: true),
    local!isNewEntry: #"_a-0000e2ad-62e7-8000-9ba2-011c48011c48_73536"(value: ri!refData.rDataId),
    local!customLabel: concat(ri!bundleName, "_custom"),
    local!customI18nData: #"_a-0000e2cd-bc96-8000-9ba2-011c48011c48_81720"(
      bundleFolder: ri!bundleFolder,
      /* Specifically retrieve only the custom data */
      bundleNames: local!customLabel,
      triggerRefresh: local!triggerRefresh
    ),
    local!updatedCustomI18nData: if(
      isnull(
        local!customI18nData[local!customLabel]
      ),
      /* If this is a new custom bundle... */
      #"_a-0000e774-a792-8000-9c04-011c48011c48_2821578"(
        keys: { ri!newLabel },
        values: { ri!newValue }
      ),
      /* If the custom bundle already exists... */
      #"_a-0000e40a-de32-8000-9ba8-011c48011c48_260165"(
        cdt: if(
          #"_a-0000e2ad-62e7-8000-9ba2-011c48011c48_73536"(ri!refData.rDataId),
          local!customI18nData[local!customLabel],
          /* If this is an update to an existing ref data entry, remove the old custom label*/
          remove(
            local!customI18nData[local!customLabel],
            /* Query here because ref label is auto-internationalized in prior query */
            index(
              substitute(
                #"_a-0000e50d-bf1d-8000-9bcd-011c48011c48_976921"(codeList: ri!refData.code).label,
                ri!bundleName &amp; ".",
                ""
              ),
              1,
              ""
            )
          )
        ),
        fields: { ri!newLabel },
        newValues: { ri!newValue }
      )
    ),
    {
      bundleDictionary: todatasubset(local!updatedCustomI18nData),
      bundleName: ri!bundleName,
      locale: #"_a-0000e2ad-62e7-8000-9ba2-011c48011c48_76004"(user: loggedInUser()),
      refData: #"_a-0000e40a-de32-8000-9ba8-011c48011c48_269170"(
        cdt: ri!refData,
        fieldValuePairs: {
          a!map(
            field: "label",
            value: ri!bundleName &amp; "." &amp; ri!newLabel
          ),
          if(
            local!isNewEntry,
            /*Pass triggerRefresh to get latest inactive results*/
            a!map(
              field: "code",
              value: #"_a-0000e539-6d59-8000-9bd0-011c48011c48_1215570"(
                refDataType: ri!refData.type,
                text: ri!newValue,
                triggerRefresh: ri!triggerRefresh
              )
            ),
            {}
          )
        }
      )
    }
  )
)</definition>
        <namedTypedValue>
            <name>bundleName</name>
            <type>
                <name>string</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
            <value/>
        </namedTypedValue>
        <namedTypedValue>
            <name>bundleFolder</name>
            <type>
                <name>CollaborationFolder</name>
                <namespace>http://www.appian.com/ae/types/2009</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>newValue</name>
            <type>
                <name>string</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
            <value/>
        </namedTypedValue>
        <namedTypedValue>
            <name>refData</name>
            <type>
                <name>AS_FS_R_Data</name>
                <namespace>urn:com:appian:types:AS:FS</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>newLabel</name>
            <type>
                <name>string</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
            <value/>
        </namedTypedValue>
        <namedTypedValue>
            <name>triggerRefresh</name>
            <type>
                <name>dateTime</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
        </namedTypedValue>
        <preferredEditor>legacy</preferredEditor>
        <offlineEnabled>false</offlineEnabled>
    </rule>
    <roleMap public="true">
        <role inherit="true" allowForAll="false" name="readers">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="authors">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="administrators">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyReaders">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAuthors">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAdministrators">
            <users/>
            <groups/>
        </role>
    </roleMap>
    <typedValue>
        <type>
            <name>RuleTestConfig?list</name>
            <namespace>http://www.appian.com/ae/types/2009</namespace>
        </type>
        <value>
            <el>
                <a:name>Update Product Type Value</a:name>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="a:Expression">"AS.FS.ProductType"</a:value>
                    <a:nameRef>bundleName</a:nameRef>
                    <a:id>1</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="a:Expression">#"_a-0000e50d-bf1d-8000-9bcd-011c48011c48_976833"</a:value>
                    <a:nameRef>bundleFolder</a:nameRef>
                    <a:id>2</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="a:Expression">"New Product Type"</a:value>
                    <a:nameRef>newValue</a:nameRef>
                    <a:id>3</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="a:Expression">#"_a-0000e50d-bf1d-8000-9bcd-011c48011c48_975301"(
  returnType: #"_a-0000e415-3035-8000-9bb2-011c48011c48_290157",
  typeList: {
    #"_a-0000e2cd-bc96-8000-9ba2-011c48011c48_41722"
  }
)</a:value>
                    <a:nameRef>refData</a:nameRef>
                    <a:id>4</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="a:Expression">"lbl_NewProductLabel"</a:value>
                    <a:nameRef>newLabel</a:nameRef>
                    <a:id>5</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true" xsi:type="xsd:dateTime"/>
                    <a:nameRef>triggerRefresh</a:nameRef>
                    <a:id>6</a:id>
                </a:ruleInputTestConfigs>
                <a:assertions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>
            </el>
            <el>
                <a:name>Update Document Type Value</a:name>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="a:Expression">"AS.FS.DocumentType"</a:value>
                    <a:nameRef>bundleName</a:nameRef>
                    <a:id>1</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="a:Expression">#"_a-0000e50d-bf1d-8000-9bcd-011c48011c48_976833"</a:value>
                    <a:nameRef>bundleFolder</a:nameRef>
                    <a:id>2</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="a:Expression">"New Document"</a:value>
                    <a:nameRef>newValue</a:nameRef>
                    <a:id>3</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="a:Expression">#"_a-0000e50d-bf1d-8000-9bcd-011c48011c48_976921"(codeList: #"_a-0000e50d-bf1d-8000-9bcd-011c48011c48_1005375")</a:value>
                    <a:nameRef>refData</a:nameRef>
                    <a:id>4</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="a:Expression">"lbl_NewDocument"</a:value>
                    <a:nameRef>newLabel</a:nameRef>
                    <a:id>5</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true" xsi:type="xsd:dateTime"/>
                    <a:nameRef>triggerRefresh</a:nameRef>
                    <a:id>6</a:id>
                </a:ruleInputTestConfigs>
                <a:assertions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>
            </el>
            <el>
                <a:name>Null case</a:name>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="xsd:string"/>
                    <a:nameRef>bundleName</a:nameRef>
                    <a:id>1</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true" xsi:type="a:CollaborationFolder"/>
                    <a:nameRef>bundleFolder</a:nameRef>
                    <a:id>2</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="xsd:string"/>
                    <a:nameRef>newValue</a:nameRef>
                    <a:id>3</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:n1="urn:com:appian:types:AS:FS" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true" xsi:type="n1:AS_FS_R_Data"/>
                    <a:nameRef>refData</a:nameRef>
                    <a:id>4</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="xsd:string"/>
                    <a:nameRef>newLabel</a:nameRef>
                    <a:id>5</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true" xsi:type="xsd:dateTime"/>
                    <a:nameRef>triggerRefresh</a:nameRef>
                    <a:id>6</a:id>
                </a:ruleInputTestConfigs>
                <a:assertions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>
            </el>
        </value>
    </typedValue>
    <history>
        <historyInfo versionUuid="_a-0000e539-6d59-8000-9bd0-011c48011c48_1181508"/>
        <historyInfo versionUuid="_a-0000e539-6d59-8000-9bd0-011c48011c48_1215610"/>
        <historyInfo versionUuid="_a-0000e586-af6f-8000-9bd2-011c48011c48_1359163"/>
        <historyInfo versionUuid="_a-0000e62c-7375-8000-9bec-011c48011c48_1804530"/>
        <historyInfo versionUuid="_a-0000e62c-7375-8000-9bec-011c48011c48_1819511"/>
        <historyInfo versionUuid="_a-0000e62c-7375-8000-9bec-011c48011c48_1919014"/>
        <historyInfo versionUuid="_a-0000e62c-7375-8000-9bec-011c48011c48_1931239"/>
        <historyInfo versionUuid="_a-0000e774-a792-8000-9c04-011c48011c48_2821655"/>
        <historyInfo versionUuid="_a-0000e81d-5ddb-8000-9c1b-011c48011c48_3539990"/>
    </history>
</contentHaul>
